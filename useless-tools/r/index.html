<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Useless Tools Redirect</title>
    <style>
      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        font-family: "IBM Plex Sans", "Segoe UI", sans-serif;
        color: #fbfaff;
        background: linear-gradient(175deg, #080710 0%, #120f23 56%, #1d1934 100%);
      }

      .panel {
        max-width: 640px;
        width: min(92vw, 640px);
        border: 1px solid rgba(223, 216, 247, 0.3);
        background: rgba(15, 13, 31, 0.9);
        border-radius: 12px;
        padding: 1.1rem;
      }

      h1 {
        margin: 0 0 0.8rem;
        font-family: "Space Mono", "SFMono-Regular", monospace;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-size: 1.1rem;
      }

      p {
        margin: 0.55rem 0;
        color: #d7d1ea;
      }

      code {
        word-break: break-all;
      }

      a {
        color: #ede7ff;
      }
    </style>
  </head>
  <body>
    <section class="panel">
      <h1>Useless Tools Redirect</h1>
      <p id="status">Checking your link...</p>
      <p id="error"></p>
      <p id="fallback"></p>
    </section>

    <script>
      (function () {
        "use strict";

        var statusEl = document.getElementById("status");
        var errorEl = document.getElementById("error");
        var fallbackEl = document.getElementById("fallback");

        function decodeBase64Url(value) {
          var normalized = value.replace(/-/g, "+").replace(/_/g, "/");
          while (normalized.length % 4) {
            normalized += "=";
          }

          var binary = atob(normalized);
          var bytes = Uint8Array.from(binary, function (char) {
            return char.charCodeAt(0);
          });

          return new TextDecoder().decode(bytes);
        }

        function parseAndValidateTarget(value) {
          var parsed;
          try {
            parsed = new URL(value);
          } catch (_error) {
            return { ok: false, error: "Target URL is malformed." };
          }

          if (parsed.protocol !== "http:" && parsed.protocol !== "https:") {
            return { ok: false, error: "Only http:// and https:// targets are allowed." };
          }

          return { ok: true, value: parsed.toString() };
        }

        function fail(message) {
          statusEl.textContent = "Unable to complete redirect.";
          errorEl.textContent = message;
          fallbackEl.textContent = "";
        }

        var params = new URLSearchParams(window.location.search);
        var version = params.get("v");
        var payloadEncoded = params.get("p");

        if (!payloadEncoded) {
          fail("Missing payload parameter: p");
          return;
        }

        if (version !== "1") {
          fail("Unsupported payload version. Expected v=1.");
          return;
        }

        var payload;
        try {
          payload = JSON.parse(decodeBase64Url(payloadEncoded));
        } catch (_error) {
          fail("Payload could not be decoded.");
          return;
        }

        if (!payload || typeof payload.target !== "string") {
          fail("Payload is missing a valid target URL.");
          return;
        }

        var validated = parseAndValidateTarget(payload.target);
        if (!validated.ok) {
          fail(validated.error);
          return;
        }

        statusEl.textContent = "Redirecting now...";
        fallbackEl.innerHTML = "If redirect does not start, open <a href=\"" + validated.value + "\" rel=\"noopener noreferrer\">this link</a>.";
        window.location.replace(validated.value);
      })();
    </script>
  </body>
</html>
